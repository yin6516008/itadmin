---
description: 产品需求文档（PRD）编写规范，定义文档结构、命名、数据库设计、API 设计、页面交互等章节的标准格式与要求。
alwaysApply: true
---

# 产品需求文档（PRD）编写规范

产品需求文档存放于 `docs/` 目录。

编写 PRD 时，必须严格按照以下结构和要求输出每个章节，确保需求的完整性和可实施性。

---

## 文档命名规范

1. 每个功能模块一个 `.md` 文件，存放于 `docs/` 目录
2. 文件名格式：`{模块中文名}.md`，如 `用户管理.md`、`技能评估.md`、`积分模块.md`
3. 如果一个模块下有多个独立的大功能需要单独成文，使用 `{模块名}-{功能名}.md`，如 `技能评估-考试管理.md`

---

## 文档结构模板

每篇 PRD 必须包含以下章节，按顺序编写：

```
# {模块名称} PRD

> 版本: v1.0
> 创建日期: YYYY-MM-DD
> 状态: 草稿 / 评审中 / 已确认

一、背景与目标
二、功能设计
三、业务流程
四、数据库设计
五、页面交互设计
六、API 设计
七、非功能性需求（如有）
```

---

## 一、背景与目标

### 要求

1. **背景**：说明为什么要做这个功能，当前存在什么问题或痛点，用 3-5 条要点列出
2. **目标**：明确本次要实现的核心目标，用编号列表，每条目标需简洁且可验证

### 示例

```markdown
### 1.1 背景

- 目前员工 IT 技能水平缺乏量化评估，无法有针对性地安排培训
- 技能数据分散在各部门，没有统一管理入口
- 新员工入职后的技能评估流程全靠线下，效率低下

### 1.2 目标

1. **统一管理**：建立 IT 技能的统一管理平台，覆盖技能分类、评估、培训
2. **量化评估**：支持技能等级划分和在线评测
3. **数据可视化**：提供团队和个人技能报告
```

---

## 二、功能设计

### 要求

这是 PRD 的核心章节，必须覆盖以下内容：

1. **模块结构总览**：用树形结构列出模块的页面层级和路由
2. **每个功能点**必须包含：
   - 功能描述和业务规则
   - 涉及的数据字段（用表格列出：字段名、类型、必填、说明）
   - 功能要求清单（用编号列表）
   - 边界条件和异常处理
3. **对比表**：如果有多种模式/方案，必须用对比表说明差异

### 格式

```markdown
### 2.1 模块结构

​```
用户管理 (/users)
├── 用户列表 (/users)         — 搜索、分页、启用/禁用
└── 用户详情 (/users/:id)     — 查看用户信息
​```

### 2.2 用户列表

#### 2.2.1 搜索

**字段定义：**

| 字段 | 类型 | 必填 | 说明 |
|---|---|---|---|
| keyword | string | 否 | 按姓名/邮箱模糊搜索 |
| status | string | 否 | active / inactive |

#### 2.2.2 创建用户

**字段定义：**

| 字段 | 类型 | 必填 | 说明 |
|---|---|---|---|
| name | string | 是 | 姓名，最长 50 字符 |
| email | string | 是 | 邮箱，唯一标识 |
| phone | string | 否 | 手机号，最长 20 字符 |

**业务规则：**

1. 邮箱不可重复，创建时校验
2. 创建后默认状态为 active
3. 手机号允许为空

**异常处理：**

- 邮箱重复 → 提示"该邮箱已注册"
- 必填字段为空 → 提示具体字段的校验信息
```

---

## 三、业务流程

### 要求

使用 **Mermaid** 流程图梳理核心业务流程，覆盖主流程和异常分支。

1. 每个核心场景一张流程图
2. 标注**分支条件**和**异常路径**
3. 标注需要**二次确认**的高危操作
4. 流程图后附必要的文字补充说明

### 格式

````markdown
### 3.1 创建用户

```mermaid
flowchart TD
    A[进入用户管理页] --> B[点击 新建用户]
    B --> C[弹出表单 Dialog]
    C --> D[填写姓名、邮箱、手机号]
    D --> E[点击 确定]
    E --> F{前端校验}
    F -->|失败| G[显示字段错误提示]
    G --> D
    F -->|通过| H[调用创建 API]
    H --> I{后端响应}
    I -->|成功| J[toast 创建成功]
    J --> K[关闭弹窗，刷新列表]
    I -->|邮箱重复| L[toast 该邮箱已注册]
    L --> D
    I -->|其他错误| M[toast 错误信息]
    M --> D
```

### 3.2 删除用户

```mermaid
flowchart TD
    A[在列表中点击 删除] --> B[弹出 AlertDialog 确认框]
    B --> C{用户选择}
    C -->|取消| D[关闭确认框]
    C -->|确认删除| E[调用删除 API]
    E --> F{后端响应}
    F -->|成功| G[toast 删除成功，刷新列表]
    F -->|失败| H[toast 错误信息]
```

**补充说明：**
- 删除为软删除，数据可通过数据库恢复
- 删除确认框文案："确定要删除用户「{name}」吗？此操作不可撤销。"
````

---

## 四、数据库设计

### 要求

1. **表结构定义**：每张表用表格列出所有字段，包括字段名、GORM 类型、约束、说明
2. **表关联关系**：用文字或 ER 图说明表之间的关系
3. **索引设计**：列出关键索引和唯一约束
4. **基础字段**：所有表包含 `id`（string/UUID 主键）、`created_at`、`updated_at`、`deleted_at`（软删除）
5. **类型映射**：遵循 PostgreSQL + GORM 约定

### GORM 类型对照表

| 业务类型 | GORM Tag | PostgreSQL 实际类型 |
|---|---|----|
| 字符串 | `gorm:"size:N"` | varchar(N) |
| 长文本 | `gorm:"type:text"` | text |
| 整数 | 默认 | integer / bigint |
| 布尔 | 默认 | boolean |
| 时间 | 默认 | timestamp |
| JSON | `gorm:"type:jsonb"` | jsonb |
| 枚举 | `gorm:"size:20"` | varchar(20)，枚举值在代码层定义 |
| UUID 主键 | `gorm:"primaryKey;size:36"` | varchar(36) |

### 格式

```markdown
### 4.1 表结构

#### user（用户表）

| 字段 | 类型 | GORM Tag | 说明 |
|---|---|---|---|
| id | string | `primaryKey;size:36` | UUID 主键 |
| name | string | `size:50;not null` | 姓名 |
| email | string | `size:100;uniqueIndex;not null` | 邮箱 |
| phone | string | `size:20` | 手机号 |
| status | string | `size:20;default:active;not null` | 状态：active / inactive |
| created_at | time.Time | 自动 | 创建时间 |
| updated_at | time.Time | 自动 | 更新时间 |
| deleted_at | gorm.DeletedAt | `index` | 软删除标记 |

**索引：**
- `uniqueIndex` on `email` — 邮箱唯一

### 4.2 表关联关系

​```
user 1 ──── N skill_record    (一个用户有多条技能记录)
skill 1 ──── N skill_record   (一个技能对应多条记录)
​```

关系说明：
1. `skill_record.user_id` → `user.id`：用户与技能记录的一对多关系
2. `skill_record.skill_id` → `skill.id`：技能与记录的一对多关系
```

### 注意事项

- 主键统一使用 UUID（`string` 类型 + `primaryKey;size:36`），由代码生成
- 枚举字段使用 `varchar` 存储，不使用数据库 enum 类型，枚举值在代码常量中定义
- 敏感字段（密码、密钥）需标注 `json:"-"` 和"加密存储"
- 外键关系需说明级联行为（CASCADE / SET NULL / RESTRICT）
- 软删除字段 `deleted_at` 必须包含，使用 GORM 内置的 `gorm.DeletedAt`

---

## 五、页面交互设计

### 要求

1. **页面布局**使用 ASCII 线框图描述整体结构和区域划分
2. **表单**使用表格描述字段、组件、校验规则、条件显隐
3. **列表页**必须说明：列定义、搜索条件、操作按钮、分页方式
4. **表单弹窗**必须说明：字段、校验规则、条件显隐
5. **详情页**必须说明：展示字段、Tab 切换、关联数据

### 格式

````markdown
### 5.1 列表页 (`/users`)

​```
┌─────────────────────────────────────────────────────────────────┐
│  用户管理                                          [+ 新建用户]  │
│  ┌─ 搜索栏 ──────────────────────────────────────────────────┐  │
│  │ [搜索姓名/邮箱...]  [全部状态 ▾]  [搜索] [重置]             │  │
│  └───────────────────────────────────────────────────────────┘  │
│  ┌─ 数据表格 ────────────────────────────────────────────────┐  │
│  │ 姓名    邮箱             手机号        状态   操作         │  │
│  │ 张三    zhang@test.com  138xxxx0001  [启用]  编辑|禁用|删除  │  │
│  │ 李四    li@test.com     139xxxx0002  [禁用]  编辑|启用|删除  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                            共 N 条  1 / X       │
└─────────────────────────────────────────────────────────────────┘
​```

**搜索条件：**

| 字段 | 组件 | 说明 |
|---|---|---|
| keyword | Input | 姓名/邮箱模糊搜索，支持回车触发 |
| status | Select | 全部 / 启用 / 禁用 |

**列定义：**

| 列 | 字段 | 渲染 | 说明 |
|-----|---|---|---|
| 姓名 | name | 文本 | - |
| 邮箱 | email | 文本 | - |
| 手机号 | phone | 文本 | - |
| 状态 | status | Badge 标签 | 启用=默认色，禁用=红色 |
| 创建时间 | created_at | 日期格式化 | yyyy-MM-dd HH:mm:ss |
| 操作 | - | 按钮组 | 编辑、启用/禁用、删除 |

**操作按钮：**

- 新建：弹窗表单，新建模式
- 编辑：弹窗表单，编辑模式（回填当前行数据）
- 启用/禁用：直接调用 API，切换状态后刷新列表
- 删除：二次确认弹窗 → 确认后删除

### 5.2 新建/编辑用户弹窗

| 字段 | 组件 | 必填 | 校验规则 | 说明 |
|---|---|---|---|---|
| 姓名 | Input | 是 | 1-50 字符 | - |
| 邮箱 | Input | 是 | 邮箱格式 | 编辑时禁用 |
| 手机号 | Input | 否 | 最长 20 字符 | - |

**交互说明：**

- 新建模式：所有字段为空，邮箱可编辑
- 编辑模式：回填用户数据，邮箱禁用不可修改
- 提交中按钮显示 loading 状态，防止重复提交
````

---

## 六、API 设计

### 要求

1. 用表格列出所有 API，包含方法、路径、说明
2. 遵循 RESTful 风格：GET 查询、POST 创建、PUT 更新、DELETE 删除
3. 路径以 `/api/v1/{资源}` 开头，使用复数名词
4. 路径参数使用 `:id` 形式
5. 按子功能分组列出
6. 标注请求参数来源（query / body / path）

### 格式

```markdown
### 6.1 用户管理

| 方法 | 路径 | 说明 |
|---|---|---|
| GET | `/api/v1/users` | 用户列表（query: page, size, keyword, status） |
| GET | `/api/v1/users/:id` | 用户详情（path: id） |
| POST | `/api/v1/users` | 创建用户（body: name, email, phone） |
| PUT | `/api/v1/users/:id` | 更新用户（path: id, body: name, phone） |
| DELETE | `/api/v1/users/:id` | 删除用户（path: id） |
| PUT | `/api/v1/users/:id/status` | 启用/禁用（path: id, body: status） |
```

---

## 七、非功能性需求

### 要求

必须覆盖以下三个方面：

1. **安全**：数据加密（敏感字段 `json:"-"`）、权限控制（AuthGuard）、审计日志、敏感操作确认（AlertDialog）
2. **性能**：分页策略（后端 Offset+Limit）、列表默认 20 条/页、TanStack Query 缓存（refetchOnWindowFocus: false）
3. **可用性**：错误提示（sonner toast）、加载状态（isLoading）、空状态（"暂无数据"）、表单校验即时反馈（FormMessage）

---

## 编写原则

1. **完整性**：每个章节都不能省略，如果某章节不适用需说明原因
2. **可实施性**：需求描述精确到字段、规则和交互细节，开发人员可直接据此编码
3. **一致性**：
   - 后端术语、命名与 `golang-backend-patterns.md` 保持一致（Handler/Service/Repository 分层、GORM Tag、errcode）
   - 前端组件名、目录结构与 `react-frontend-patterns.md` 保持一致（features/、shadcn/ui 组件、TanStack Query hooks）
   - API 路径与后端路由规范一致（RESTful、`/api/v1/` 前缀）
4. **可追溯性**：文档头部标注版本和状态，重大变更需记录更新日志
