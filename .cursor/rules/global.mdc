---
description: 项目全局约定，适用于所有对话
alwaysApply: true
---

# 全局约定

- 使用中文回复
- 遵循项目现有代码风格和目录结构
- 提交信息使用英文，遵循 Conventional Commits 规范
- 敏感信息（密钥、密码、token）不得写入代码或提交到仓库
- 优先编辑已有文件，避免创建不必要的新文件

---

# 任务执行流程

收到用户需求后，先判断任务类型，再按对应流程执行。

```mermaid
flowchart TD
    A[收到用户需求] --> B{判断任务类型}

    B -->|新功能| C1[查阅 docs/ 是否已有相关 PRD]
    C1 -->|无| C2["按 doc-patterns 规范编写 PRD"]
    C1 -->|有| C3[在已有 PRD 中补充新功能章节]
    C2 --> C4[用户确认 PRD]
    C3 --> C4
    C4 --> C5[按 PRD 实现代码]
    C5 --> C6[自测验证]

    B -->|Bug 修复| D1[定位问题根因]
    D1 --> D2{PRD 中有相关描述？}
    D2 -->|是且 PRD 有缺陷| D3[修正 PRD 中的描述]
    D3 --> D4[修复代码]
    D2 -->|否或 PRD 无误| D4
    D4 --> D5[自测验证]

    B -->|需求变更| E1[对比现有 PRD 找出变更点]
    E1 --> E2[更新 PRD 中受影响的章节]
    E2 --> E3[用户确认变更]
    E3 --> E4[修改代码适配新需求]
    E4 --> E5[自测验证]

    B -->|重构优化| F1[分析现有代码问题]
    F1 --> F2{涉及功能行为变化？}
    F2 -->|是| F3[更新 PRD 相关描述]
    F3 --> F4[重构代码]
    F2 -->|否| F4
    F4 --> F5[自测验证]

    B -->|技术调研 / 问答| G1[查阅代码和文档]
    G1 --> G2[给出分析和建议]
```

## 流程说明

| 任务类型 | 核心原则 | 关键动作 |
|---|---|---|
| **新功能** | 文档先行 | 先写/补充 PRD → 确认 → 再编码 |
| **Bug 修复** | 先定位后修复 | 找根因 → 检查 PRD 是否需修正 → 修复代码 |
| **需求变更** | 文档同步 | 对比变更 → 更新 PRD → 确认 → 改代码 |
| **重构优化** | 行为不变则不改文档 | 判断是否影响功能行为 → 按需更新 PRD |
| **技术调研 / 问答** | 只读分析 | 查阅代码和文档 → 给出建议，不直接改代码 |
